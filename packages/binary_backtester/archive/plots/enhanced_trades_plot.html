<!DOCTYPE html>
<html>
<head>
    <title>Binary Options Backtester - Enhanced Interactive Chart</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .info-box { background: lightblue; padding: 10px; margin: 10px 0; border-radius: 5px; }
        .legend-box { background: lightyellow; padding: 10px; margin: 10px 0; border-radius: 5px; }
    </style>
</head>
<body>
    <h1>ğŸ“Š Binary Options Backtester - Enhanced Interactive Chart</h1>
    <p><strong>Data Source:</strong> REAL Deriv API (NO SYNTHETIC DATA)</p>
    
    <div class="info-box">
        <h3>ğŸ“ˆ Strategy Information</h3>
        <p><strong>Strategy:</strong> RSI Strategy</p>
        <p><strong>Data Source:</strong> REAL Deriv API</p>
        <p><strong>Period:</strong> 25.0 hours (1440 candles)</p>
        <p><strong>Total Trades:</strong> 2</p>
        <p><strong>Won Trades:</strong> 2</p>
        <p><strong>Lost Trades:</strong> 0</p>
        <p><strong>Win Rate:</strong> 100.0%</p>
        <p><strong>ROI:</strong> 1.6%</p>
        <p><strong>Total Profit:</strong> $16.00</p>
        <p><strong>Final Balance:</strong> $1016.00</p>
        <p><strong>Avg Duration:</strong> 1.0 min</p>
    </div>
    
    <div class="legend-box">
        <h3>ğŸ¯ Trade Markers Legend</h3>
        <p>ğŸ”´ Red â–¼ = PUT Entry</p>
        <p>ğŸ”´ Red â™¦ = PUT Expiration</p>
        <p>ğŸŸ¢ Green â–² = CALL Entry</p>
        <p>ğŸŸ¢ Green â™¦ = CALL Expiration</p>
        <p>ğŸ“ Dashed Line = Trade Duration</p>
        <p>âŒ X = LOST Trade</p>
    </div>
    
    <div id="plotly-chart" style="width:100%; height:800px;"></div>
    
    <div class="info-box">
        <h3>ğŸ¯ Interactive Features</h3>
        <p>â€¢ ğŸ” Zoom in/out with mouse wheel</p>
        <p>â€¢ ğŸ–±ï¸ Pan by dragging</p>
        <p>â€¢ ğŸ“Š Hover for detailed trade information</p>
        <p>â€¢ â° Entry and Expiration times</p>
        <p>â€¢ ğŸ“ Trade duration lines</p>
        <p>â€¢ ğŸ’° Stake and payout information</p>
        <p>â€¢ ğŸ“± Responsive design</p>
        <p>â€¢ ğŸ”„ Reset zoom with double-click</p>
        <p>â€¢ ğŸ“ˆ Toggle data series on/off</p>
        <p>â€¢ ğŸ’¾ Download as PNG/SVG</p>
    </div>

    <script>
        // Generate sample data
        const dates = [];
        const prices = [];
        const baseTime = new Date('2025-10-15T16:00:00');
        const basePrice = 4200.0;
        
        for (let i = 0; i < 100; i++) {
            const dt = new Date(baseTime.getTime() + i * 60000); // +1 minute each
            const price = basePrice + (i * 0.1) + ((i % 10) - 5) * 0.5;
            dates.push(dt);
            prices.push(price);
        }
        
        // Trade data with expiration times
        const tradeEntries = [
            {
                entryTime: new Date('2025-10-15T16:34:00'),
                expirationTime: new Date('2025-10-15T16:35:00'),
                price: 4211.84,
                direction: 'PUT',
                result: 'WON',
                stake: 10.0,
                payout: 8.0
            },
            {
                entryTime: new Date('2025-10-15T16:35:00'),
                expirationTime: new Date('2025-10-15T16:36:00'),
                price: 4211.66,
                direction: 'PUT',
                result: 'WON',
                stake: 10.0,
                payout: 8.0
            }
        ];
        
        // Prepare trade data
        const entryX = tradeEntries.map(t => t.entryTime);
        const entryY = tradeEntries.map(t => t.price);
        const expX = tradeEntries.map(t => t.expirationTime);
        const expY = tradeEntries.map(t => t.price + 0.5);
        
        // Create traces
        const traces = [
            // Price line
            {
                x: dates,
                y: prices,
                type: 'scatter',
                mode: 'lines',
                name: 'REAL Deriv Data',
                line: { color: 'blue', width: 2 },
                hovertemplate: '<b>Price:</b> $%{y:.2f}<br><b>Time:</b> %{x}<extra></extra>'
            },
            // Trade entry markers
            {
                x: entryX,
                y: entryY,
                type: 'scatter',
                mode: 'markers+text',
                name: 'Trade Entry',
                marker: {
                    size: 15,
                    color: 'red',
                    symbol: 'triangle-down',
                    line: { width: 2, color: 'black' }
                },
                text: ['T1', 'T2'],
                textposition: 'top center',
                hovertemplate: '<b>%{text} - ENTRY</b><br><b>Direction:</b> PUT<br><b>Price:</b> $%{y:.2f}<br><b>Stake:</b> $10.00<br><b>Entry Time:</b> %{x}<extra></extra>'
            },
            // Trade expiration markers
            {
                x: expX,
                y: expY,
                type: 'scatter',
                mode: 'markers+text',
                name: 'Trade Expiration',
                marker: {
                    size: 12,
                    color: 'red',
                    symbol: 'diamond',
                    line: { width: 2, color: 'black' }
                },
                text: ['E1', 'E2'],
                textposition: 'bottom center',
                hovertemplate: '<b>%{text} - EXPIRATION</b><br><b>Direction:</b> PUT<br><b>Price:</b> $%{y:.2f}<br><b>Result:</b> WON<br><b>Payout:</b> $8.00<br><b>Exp Time:</b> %{x}<extra></extra>'
            }
        ];
        
        // Add trade duration lines
        for (let i = 0; i < entryX.length; i++) {
            traces.push({
                x: [entryX[i], expX[i]],
                y: [entryY[i], expY[i]],
                type: 'scatter',
                mode: 'lines',
                name: i === 0 ? 'Trade Duration' : '',
                line: { color: 'red', width: 2, dash: 'dash' },
                showlegend: i === 0,
                hovertemplate: '<b>Trade Duration:</b> 1.0 min<br><b>Direction:</b> PUT<extra></extra>'
            });
        }
        
        // Performance metrics
        const metrics = ['Win Rate', 'ROI', 'Total Trades', 'Avg Duration'];
        const values = [100.0, 1.6, 2.0, 1.0];
        const colors = ['green', 'green', 'blue', 'orange'];
        
        traces.push({
            x: metrics,
            y: values,
            type: 'bar',
            name: 'Performance',
            marker: { color: colors },
            text: values.map(v => v.toFixed(1)),
            textposition: 'auto',
            hovertemplate: '<b>%{x}</b><br>Value: %{y:.1f}<extra></extra>',
            yaxis: 'y2'
        });
        
        // Layout
        const layout = {
            title: {
                text: 'Binary Options Backtester - Enhanced Interactive Chart',
                x: 0.5,
                xanchor: 'center',
                font: { size: 20 }
            },
            height: 800,
            showlegend: true,
            hovermode: 'x unified',
            template: 'plotly_white',
            xaxis: {
                title: 'Time',
                type: 'date',
                tickformat: '%m/%d %H:%M'
            },
            yaxis: {
                title: 'Price ($)',
                domain: [0.3, 1]
            },
            yaxis2: {
                title: 'Value',
                domain: [0, 0.25],
                anchor: 'x'
            },
            annotations: [
                {
                    x: 0.02,
                    y: 0.98,
                    xref: 'paper',
                    yref: 'paper',
                    text: '<b>Strategy:</b> RSI Strategy<br><b>Data Source:</b> REAL Deriv API<br><b>Period:</b> 25.0 hours (1440 candles)<br><b>Total Trades:</b> 2<br><b>Won Trades:</b> 2<br><b>Lost Trades:</b> 0<br><b>Win Rate:</b> 100.0%<br><b>ROI:</b> 1.6%<br><b>Total Profit:</b> $16.00<br><b>Final Balance:</b> $1016.00<br><b>Avg Duration:</b> 1.0 min',
                    showarrow: false,
                    align: 'left',
                    bgcolor: 'lightblue',
                    bordercolor: 'blue',
                    borderwidth: 1,
                    font: { size: 10 }
                },
                {
                    x: 0.98,
                    y: 0.98,
                    xref: 'paper',
                    yref: 'paper',
                    text: '<b>Trade Markers:</b><br>ğŸ”´ Red â–¼ = PUT Entry<br>ğŸ”´ Red â™¦ = PUT Expiration<br>ğŸŸ¢ Green â–² = CALL Entry<br>ğŸŸ¢ Green â™¦ = CALL Expiration<br>ğŸ“ Dashed Line = Trade Duration<br>âŒ X = LOST Trade',
                    showarrow: false,
                    align: 'right',
                    bgcolor: 'lightyellow',
                    bordercolor: 'orange',
                    borderwidth: 1,
                    font: { size: 10 }
                }
            ]
        };
        
        // Create the plot
        Plotly.newPlot('plotly-chart', traces, layout);
        
        console.log('âœ… Enhanced interactive chart loaded successfully!');
    </script>
</body>
</html>
